{% extends "base.html" %}
{% block title%}도로용 CCTV 페이지{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/user_dashboard.css') }}">
<style>
.search-container {
    display: flex;
    align-items: center;
    justify-content: space-between; /* 왼쪽 정렬 + 오른쪽 정렬 */
    width: 100%;
}

.search-container .total-count {
    font-weight: bold;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
{% endblock %}
{% block content %}
<!-- 가로등 조회 폼 -->
<div class="search-container">
    <div>
        <i class="fa-solid fa-lightbulb" style="color: rgb(236, 119, 9);"></i>
        <span class="total-count">검색된 가로등 : {{ total_posts }}개</span>
    </div>
    <form method="get" action="{{ url_for('user_dashboard_road', userid=user.user_id) }}">
        <label for="search_type">검색 타입:</label>
        <select name="search_type" id="search_type">
            <option value="street_light_id" {% if search_type == 'street_light_id' %}selected{% endif %}>가로등 번호</option>
            <option value="street_light_location" {% if search_type == 'location' %}selected{% endif %}>위치</option>
            <option value="all" {% if search_type == 'all' %}selected{% endif %}>전체</option>
        </select>
        
        <label for="search_query">가로등 번호 또는 위치:</label>
        <input type="text" name="search_query" id="search_query" placeholder="가로등 번호 또는 위치" value="{{ search_query }}">
        
        <button type="submit">검색</button>
    </form>
</div>

<!-- 가로등 목록 테이블 -->
<table>
    <thead>
        <tr>
            <th>가로등 번호</th>
            <th>위치</th>
            <th>실시간 CCTV</th>
        </tr>
    </thead>
    <tbody>
        {% for street_light in street_lights %}
            <tr>
                <td>{{ street_light.street_light_id }}</td>
                <td>{{ street_light.location }}</td>
                {% if street_light.cctv_ip %}
                <td>
                    <a href="{{ url_for('user_dashboard_cctv', userid=user.user_id, street_light_id = street_light.street_light_id) }}" class="btn btn-primary">
                        상세 보기
                    </a>
                    <i class="fa-solid fa-video fa-2x"></i> <!-- 일반적인 CCTV 아이콘 -->
                </td>
                {% else %}
                <td>
                    <a href="#" class="btn btn-secondary">미설치</a>
                    <i class="fa-solid fa-video-slash fa-2x" style="color:gray"></i>
                </td>
                {% endif %}
            </tr>
        {% else %}
            <tr>
                <td colspan="3">검색된 가로등 정보가 없습니다.</td>
            </tr>
        {% endfor %}

        <!-- 부족한 행을 채우기 -->
        {% set remaining_rows = 10 - street_lights|length %}
        {% if remaining_rows > 0 %}
            {% for _ in range(remaining_rows) %}
                <tr class="empty-row">
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
            {% endfor %}
        {% endif %}
    </tbody>
</table>

<!-- 페이지네이션 -->
<div class="pagination">
    {% if prev_page %}
        <a href="{{ url_for('user_dashboard_road', userid=user.user_id, search_query=search_query, search_type=search_type, page=prev_page) }}">이전</a>
    {% endif %}
    <span>페이지 {{ page }} / {{ total_pages }}</span>
    {% if next_page %}
        <a href="{{ url_for('user_dashboard_road', userid=user.user_id, search_query=search_query, search_type=search_type, page=next_page) }}">다음</a>
    {% endif %}
</div>
{% endblock %}
</body>
</html>
